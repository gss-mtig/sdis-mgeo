


<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Infraestructuras de datos espaciales y estándares de geoservicios.">
      
      
        <link rel="canonical" href="https://gss-mtig.github.io/sdis-mgeo-20-21/10_ejemplo_servicio_bicing_bcn_vt/">
      
      
        <meta name="author" content="sdis-mgeo">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>10. Ejemplo servicio bicing Barcelona (VectorTiles) - Infraestructuras de datos espaciales y estándares de geoservicios</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4dd2dd8d.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ejemplo-servicio-bicing-barcelona-vectortiles" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Cabecera">
    <a href="https://gss-mtig.github.io/sdis-mgeo-20-21/" title="Infraestructuras de datos espaciales y estándares de geoservicios" class="md-header-nav__button md-logo" aria-label="Infraestructuras de datos espaciales y estándares de geoservicios">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Infraestructuras de datos espaciales y estándares de geoservicios
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              10. Ejemplo servicio bicing Barcelona (VectorTiles)
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Limpiar" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/gss-mtig/sdis-mgeo-20-21/" title="Ir al repositorio" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://gss-mtig.github.io/sdis-mgeo-20-21/" title="Infraestructuras de datos espaciales y estándares de geoservicios" class="md-nav__button md-logo" aria-label="Infraestructuras de datos espaciales y estándares de geoservicios">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Infraestructuras de datos espaciales y estándares de geoservicios
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/gss-mtig/sdis-mgeo-20-21/" title="Ir al repositorio" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../1_introduccion_a_las_ides/" title="1. Introducción a las IDE's" class="md-nav__link">
      1. Introducción a las IDE's
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../2_estandares_OCG/" title="2. Estándares OCG" class="md-nav__link">
      2. Estándares OCG
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../3_estandares_ISO/" title="3. Estándares ISO" class="md-nav__link">
      3. Estándares ISO
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../4_visualizacion_kepler/" title="4. Visualización con Kepler.gl" class="md-nav__link">
      4. Visualización con Kepler.gl
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../5_herramientas_visualizacion_datos/" title="5. Herramientas de visualización de datos" class="md-nav__link">
      5. Herramientas de visualización de datos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../6_conceptos_geoservicios/" title="6. Conceptos básicos de Geoservicios" class="md-nav__link">
      6. Conceptos básicos de Geoservicios
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../7_ejemplo_servicio_wms/" title="7. Ejemplo servicio WMS" class="md-nav__link">
      7. Ejemplo servicio WMS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../8_consideraciones_servicios_opendata/" title="8. Consideraciones sobre servicios Open data" class="md-nav__link">
      8. Consideraciones sobre servicios Open data
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../9_ejemplo_servicio_bicing_bcn/" title="9. Ejemplo servicio bicing Barcelona" class="md-nav__link">
      9. Ejemplo servicio bicing Barcelona
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        10. Ejemplo servicio bicing Barcelona (VectorTiles)
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="10. Ejemplo servicio bicing Barcelona (VectorTiles)" class="md-nav__link md-nav__link--active">
      10. Ejemplo servicio bicing Barcelona (VectorTiles)
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#acceso-al-servicio-de-datos-del-bicing-de-barcelona" class="md-nav__link">
    Acceso al servicio de datos del Bicing de Barcelona
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-un-visor" class="md-nav__link">
    Creación de un visor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-del-proxy" class="md-nav__link">
    Creación del proxy
  </a>
  
    <nav class="md-nav" aria-label="Creación del proxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modificar-el-visor" class="md-nav__link">
    Modificar el visor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificar-el-proxy" class="md-nav__link">
    Modificar el proxy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificar-el-visor_1" class="md-nav__link">
    Modificar el visor
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../11_consideraciones_servicios_realtime_sensores/" title="11. Consideraciones sobre servicios de Sensores" class="md-nav__link">
      11. Consideraciones sobre servicios de Sensores
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../13_ejemplo_sentilo_aca/" title="12. Ejemplo Sentilo ACA" class="md-nav__link">
      12. Ejemplo Sentilo ACA
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../14_geoservicios_realtime/" title="13. Geoservicios realtime" class="md-nav__link">
      13. Geoservicios realtime
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../15_herramientas_visualizacion_geoservicios/" title="14. Herramientas de visualización geoservicios" class="md-nav__link">
      14. Herramientas de visualización geoservicios
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../16_ejemplo_mobility/" title="15. Ejemplo Mobility" class="md-nav__link">
      15. Ejemplo Mobility
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../17_ejemplo_geoservicio_realtime/" title="16. Ejemplo servicio realtime para compartir la ubicación" class="md-nav__link">
      16. Ejemplo servicio realtime para compartir la ubicación
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../18_ejemplo_gtfs/" title="17. Ejemplo GTFS" class="md-nav__link">
      17. Ejemplo GTFS
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#acceso-al-servicio-de-datos-del-bicing-de-barcelona" class="md-nav__link">
    Acceso al servicio de datos del Bicing de Barcelona
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-un-visor" class="md-nav__link">
    Creación de un visor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-del-proxy" class="md-nav__link">
    Creación del proxy
  </a>
  
    <nav class="md-nav" aria-label="Creación del proxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modificar-el-visor" class="md-nav__link">
    Modificar el visor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificar-el-proxy" class="md-nav__link">
    Modificar el proxy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificar-el-visor_1" class="md-nav__link">
    Modificar el visor
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/gss-mtig/sdis-mgeo-20-21/edit/master/docs/10_ejemplo_servicio_bicing_bcn_vt.md" title="Editar esta página" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="ejemplo-servicio-bicing-barcelona-vectortiles">Ejemplo servicio bicing Barcelona VectorTiles</h1>
<h2 id="acceso-al-servicio-de-datos-del-bicing-de-barcelona">Acceso al servicio de datos del Bicing de Barcelona</h2>
<p>En el portal Open data del Ayuntamiento de Barcelona podemos encontrar un dataset (conjunto de datos) que contiene las <a href="https://opendata-ajuntament.barcelona.cat/data/es/dataset?q=bicing&amp;sort=fecha_publicacion+desc">estaciones del servicio de Bicing</a></p>
<p>Anteriormente tenían un servicio donde daban toda la información de la estación en tiempo real <a href="http://wservice.viabicing.cat/v2/stations">http://wservice.viabicing.cat/v2/stations</a>. Actualmente lo han separado en dos servicios unos con la <a href="https://opendata-ajuntament.barcelona.cat/data/es/dataset/informacio-estacions-bicing">información de las estaciones</a> (identificador, nombre, coordenadas, etc.) y otro con <a href="https://opendata-ajuntament.barcelona.cat/data/es/dataset/estat-estacions-bicing">estado de las estaciones</a> (número de bicis disponibles, tipos de bicis, etc)</p>
<p>Si bien el Ayuntamiento de Barcelona no ofrece explicitamente el acceso a los datos del Bicing como un servicio, si que tiene un servicio de datos en tiempo real. La url la podemos encontrar presionando el botón de Descargar del recurso json</p>
<p><img alt="url servicio de bicing" src="../img/bicing.png" />
<em>url servicio de bicing</em></p>
<p>Al abrir la url <a href="https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information">https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information</a> en nuestro navegador observaremos que la respuesta es un archivo json con un conjunto de elementos que tienen las coordenadas de la localización de la estación de bicing, la dirección, la capacidad, etc.</p>
<p>Mapa que utiliza este servicio, <a href="https://www.bicing.barcelona/es/mapa-de-disponibilidad-provisional">https://www.bicing.barcelona/es/mapa-de-disponibilidad-provisional</a></p>
<p>El archivo json que retorna el servicio tiene coordenadas pero no es un fichero GeoJSON. <sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></p>
<p>Para ver estos datos sobre un mapa crearemos un visor utilizando Mapbox GL JS. <sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup></p>
<h2 id="creacion-de-un-visor">Creación de un visor</h2>
<ul>
<li>Crer una carpeta con el nombre de <em>visor-bicing-vt</em>.</li>
<li>Crer una carpeta con el nombre de <em>public</em> dentro de la carpeta visor-bicing-vt.</li>
<li>Crear un archivo con el nombre de <em>index.html</em> dentro de la carpeta public.</li>
<li>Abrir el archivo index.html con un editor de texto y copiar el siguiente código.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Servicio de Bicing realtime VectorTiles<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;viewport&#39;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#39;initial-scale=1,maximum-scale=1,user-scalable=no&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css&#39;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="nt">body</span> <span class="p">{</span>
      <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">#</span><span class="nn">map</span> <span class="p">{</span>
      <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
      <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
      <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
      <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;https://geoserveis.icgc.cat/contextmaps/icgc.json&#39;</span><span class="p">,</span>
      <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.1777</span><span class="p">,</span> <span class="mf">41.3887</span><span class="p">],</span>
      <span class="nx">zoom</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
      <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
      <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<ul>
<li>Abrir el archivo index.html en el navegador para ver que carga un mapa centrado en Barcelona.</li>
</ul>
<h2 id="creacion-del-proxy">Creación del proxy</h2>
<p>Crearemos un proxy que nos permita  </p>
<ul>
<li>Instalar Node.js <sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup>. Descargar la última versión LTS (en este momento es la 12.13.1 LTS) y lo instalaremos con las opciones por defecto. Una vez instalado el Node abrir la consola para verificar que se ha instalado correctamente. Escribir</li>
</ul>
<div class="highlight"><pre><span></span><code>node -v
</code></pre></div>

<ul>
<li>Navegar hasta nuestra carpeta <em>visor-bicing-vt</em> y escribir:</li>
</ul>
<div class="highlight"><pre><span></span><code>npm init
</code></pre></div>

<p>Con este comando estaremos creando el archivo <em>package.json</em>. Este comando solicita varios elementos como, por ejemplo, el nombre y la versión de la aplicación. Por ahora, sólo hay que pulsar ENTER para aceptar los valores predeterminados.</p>
<ul>
<li>
<p>Instalar las dependencias para crear nuestro servicio de proxy <sup id="fnref:4"><a class="footnote-ref" href="#fn:4">4</a></sup>. En este caso utilizaremos Express <sup id="fnref:5"><a class="footnote-ref" href="#fn:5">5</a></sup> como servidor web y el módulo axios <sup id="fnref:6"><a class="footnote-ref" href="#fn:6">6</a></sup>.</p>
</li>
<li>
<p>Instalar el express y guardarlo en la lista de dependencias</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>npm install express --save
</code></pre></div>

<ul>
<li>Instalar el axios y guardarlo en la lista de dependencias</li>
</ul>
<div class="highlight"><pre><span></span><code>npm install axios --save
</code></pre></div>

<p>Al ejecutar estos comandos veremos que se crea una carpeta llamada <em>node_modules</em> donde se guardan los módulos instalados.</p>
<ul>
<li>Crear un archivo llamado <em>app.js</em> que servirá de proxy con el servicio de Bicing. Copiar lo siguiente en este archivo.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">var</span> <span class="nx">express</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span>      <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;axios&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">serverBicing</span> <span class="o">=</span> <span class="s1">&#39;https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information&#39;</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;/bicingjson/*&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;redirecting to Server2&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">geojson</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;FeatureCollection&#39;</span><span class="p">,</span>
    <span class="nx">features</span><span class="o">:</span> <span class="p">[]</span>
  <span class="p">};</span>
  <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">serverBicing</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
    <span class="c1">// handle success</span>
    <span class="kd">var</span> <span class="nx">stations</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">stations</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">stations</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">station</span> <span class="o">=</span> <span class="nx">stations</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">feature</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">,</span>
        <span class="nx">properties</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">altitude</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">altitude</span><span class="p">,</span>
          <span class="nx">id</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">station_id</span><span class="p">,</span>
          <span class="nx">address</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
          <span class="nx">post_code</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">post_code</span><span class="p">,</span>
          <span class="nx">capacity</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">capacity</span>
        <span class="p">},</span>
        <span class="nx">geometry</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span>
          <span class="nx">coordinates</span><span class="o">:</span> <span class="p">[</span><span class="nx">station</span><span class="p">.</span><span class="nx">lon</span><span class="p">,</span> <span class="nx">station</span><span class="p">.</span><span class="nx">lat</span><span class="p">]</span>
        <span class="p">}</span>
      <span class="p">};</span>
      <span class="nx">geojson</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">feature</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">geojson</span><span class="p">);</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</code></pre></div>

<ul>
<li>Probar que nuestro proxy está funcionando, escribiendo:</li>
</ul>
<div class="highlight"><pre><span></span><code>node app.js
</code></pre></div>

<ul>
<li>
<p>Abrir la url de nuestro proxy <a href="http://localhost:3000/bicingjson/">http://localhost:3000/bicingjson/</a> en el navegador.</p>
</li>
<li>
<p>Escribir en el navegador <a href="http://localhost:3000">http://localhost:3000</a> para ver nuestro mapa.</p>
</li>
</ul>
<h3 id="modificar-el-visor">Modificar el visor</h3>
<ul>
<li>Modificar el archivo index.html para que llame al proxy que hemos creado y cargue la capa de bicing. Escribir justo despues de la declaración del mapa.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Servicio de Bicing realtime VectorTiles<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;viewport&#39;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#39;initial-scale=1,maximum-scale=1,user-scalable=no&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css&#39;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="nt">body</span> <span class="p">{</span>
      <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">#</span><span class="nn">map</span> <span class="p">{</span>
      <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
      <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
      <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
      <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;https://geoserveis.icgc.cat/contextmaps/icgc.json&#39;</span><span class="p">,</span>
      <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.1777</span><span class="p">,</span> <span class="mf">41.3887</span><span class="p">],</span>
      <span class="nx">zoom</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
      <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
      <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>

<span class="hll">    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="hll">      <span class="c1">//funcion que se llama al terminar de cargar el estilo del mapa</span>
</span><span class="hll">
</span><span class="hll">      <span class="c1">//agregamos la fuente de datos al mapa</span>
</span><span class="hll">      <span class="nx">map</span><span class="p">.</span><span class="nx">addSource</span><span class="p">(</span><span class="s1">&#39;bicing-source&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;geojson&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">data</span><span class="o">:</span> <span class="s1">&#39;http://localhost:3000/bicingjson/&#39;</span>
</span><span class="hll">      <span class="p">});</span>
</span><span class="hll">
</span><span class="hll">      <span class="c1">//agregamos la capa con su estilo al mapa</span>
</span><span class="hll">      <span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">({</span>
</span><span class="hll">        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing-source&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="s2">&quot;paint&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">            <span class="s2">&quot;circle-radius&quot;</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span><span class="hll">            <span class="s2">&quot;circle-color&quot;</span><span class="o">:</span> <span class="s2">&quot;#B42222&quot;</span>
</span><span class="hll">        <span class="p">},</span>
</span><span class="hll">      <span class="p">});</span>
</span><span class="hll">    <span class="p">});</span>
</span>  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<ul>
<li>
<p>Recargar la aplicación y veremos los puntos de las estaciones de bicing.</p>
</li>
<li>
<p>Actualizar los datos del mapa. Para actualizar los datos del mapa se debe recargar la capa de estaciones de bicing cada X tiempo. Para recargar la capa cada 3 segundos escribir los siguiente al final de la función que se llama al terminar de cargar el estilo del mapa.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Servicio de Bicing realtime VectorTiles<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;viewport&#39;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#39;initial-scale=1,maximum-scale=1,user-scalable=no&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css&#39;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="nt">body</span> <span class="p">{</span>
      <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">#</span><span class="nn">map</span> <span class="p">{</span>
      <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
      <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
      <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
      <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;https://geoserveis.icgc.cat/contextmaps/icgc.json&#39;</span><span class="p">,</span>
      <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.1777</span><span class="p">,</span> <span class="mf">41.3887</span><span class="p">],</span>
      <span class="nx">zoom</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
      <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
      <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">//funcion que se llama al terminar de cargar el estilo del mapa</span>

      <span class="c1">//agregamos la fuente de datos al mapa</span>
      <span class="nx">map</span><span class="p">.</span><span class="nx">addSource</span><span class="p">(</span><span class="s1">&#39;bicing-source&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;geojson&#39;</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="s1">&#39;http://localhost:3000/bicingjson/&#39;</span>
      <span class="p">});</span>

      <span class="c1">//agregamos la capa con su estilo al mapa</span>
      <span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">({</span>
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing-source&quot;</span><span class="p">,</span>
        <span class="s2">&quot;paint&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;circle-radius&quot;</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
            <span class="s2">&quot;circle-color&quot;</span><span class="o">:</span> <span class="s2">&quot;#B42222&quot;</span>
        <span class="p">},</span>
      <span class="p">});</span>

<span class="hll">      <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">map</span><span class="p">.</span><span class="nx">getSource</span><span class="p">(</span><span class="s1">&#39;bicing-source&#39;</span><span class="p">).</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000/bicingjson/&#39;</span><span class="p">);</span>
</span><span class="hll">      <span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
</span>    <span class="p">});</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<ul>
<li>
<p>Recargar la aplicación y veremos los puntos de las estaciones de bicing. Si vamos a la pestaña de red (network) en la consola de desarrollador del navegador podremos ver que cada 3 segundos se hace una llamada a nuestro proxy.</p>
</li>
<li>
<p>Cambiar el estilo de la capa de estaciones de bicing. Para representar las estaciones con un estilo basado en los valores de algunos de sus atributos utilizar el <em>data-driven style</em> siguiendo la especificación de estilo de Mapbox <sup id="fnref:7"><a class="footnote-ref" href="#fn:7">7</a></sup>. Modificar la propiedad <strong>paint</strong> de la capa y escribir</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Servicio de Bicing realtime VectorTiles<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;viewport&#39;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#39;initial-scale=1,maximum-scale=1,user-scalable=no&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css&#39;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="nt">body</span> <span class="p">{</span>
      <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">#</span><span class="nn">map</span> <span class="p">{</span>
      <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
      <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
      <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
      <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;https://geoserveis.icgc.cat/contextmaps/icgc.json&#39;</span><span class="p">,</span>
      <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.1777</span><span class="p">,</span> <span class="mf">41.3887</span><span class="p">],</span>
      <span class="nx">zoom</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
      <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
      <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">//funcion que se llama al terminar de cargar el estilo del mapa</span>

      <span class="c1">//agregamos la fuente de datos al mapa</span>
      <span class="nx">map</span><span class="p">.</span><span class="nx">addSource</span><span class="p">(</span><span class="s1">&#39;bicing-source&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;geojson&#39;</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="s1">&#39;http://localhost:3000/bicingjson/&#39;</span>
      <span class="p">});</span>

      <span class="c1">//agregamos la capa con su estilo al mapa</span>
      <span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">({</span>
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing-source&quot;</span><span class="p">,</span>
<span class="hll">        <span class="s2">&quot;paint&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">          <span class="s2">&quot;circle-radius&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class="hll">            <span class="s2">&quot;interpolate&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">],</span>
</span><span class="hll">            <span class="p">[</span><span class="s2">&quot;to-number&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">,</span><span class="s1">&#39;capacity&#39;</span><span class="p">]],</span>
</span><span class="hll">            <span class="mi">15</span><span class="p">,</span>
</span><span class="hll">            <span class="mi">5</span><span class="p">,</span>
</span><span class="hll">            <span class="mi">50</span><span class="p">,</span>
</span><span class="hll">            <span class="mi">33</span>
</span><span class="hll">          <span class="p">],</span>
</span><span class="hll">          <span class="s2">&quot;circle-color&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class="hll">            <span class="s2">&quot;interpolate&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">],</span>
</span><span class="hll">            <span class="p">[</span><span class="s2">&quot;to-number&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;altitude&quot;</span><span class="p">]],</span>
</span><span class="hll">            <span class="mi">0</span><span class="p">,</span>
</span><span class="hll">            <span class="s2">&quot;hsl(0, 88%, 55%)&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="mi">50</span><span class="p">,</span>
</span><span class="hll">            <span class="s2">&quot;hsl(108, 93%, 59%)&quot;</span>
</span><span class="hll">          <span class="p">],</span>
</span><span class="hll">          <span class="s2">&quot;circle-opacity&quot;</span><span class="o">:</span> <span class="mf">0.86</span>
</span><span class="hll">        <span class="p">},</span>
</span>      <span class="p">});</span>

      <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">map</span><span class="p">.</span><span class="nx">getSource</span><span class="p">(</span><span class="s1">&#39;bicing-source&#39;</span><span class="p">).</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000/bicingjson/&#39;</span><span class="p">);</span>
      <span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<ul>
<li>
<p>Recargar la aplicación y veremos el cambio de estilo de los puntos de las estaciones de bicing.</p>
</li>
<li>
<p>Crear un popup para ver la información de la estación al seleccionarla. Escribir después de donde definimos el onload</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Servicio de Bicing realtime VectorTiles<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;viewport&#39;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#39;initial-scale=1,maximum-scale=1,user-scalable=no&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css&#39;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="nt">body</span> <span class="p">{</span>
      <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">#</span><span class="nn">map</span> <span class="p">{</span>
      <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
      <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
      <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
      <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;https://geoserveis.icgc.cat/contextmaps/icgc.json&#39;</span><span class="p">,</span>
      <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.1777</span><span class="p">,</span> <span class="mf">41.3887</span><span class="p">],</span>
      <span class="nx">zoom</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
      <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
      <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">//funcion que se llama al terminar de cargar el estilo del mapa</span>

      <span class="c1">//agregamos la fuente de datos al mapa</span>
      <span class="nx">map</span><span class="p">.</span><span class="nx">addSource</span><span class="p">(</span><span class="s1">&#39;bicing-source&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;geojson&#39;</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="s1">&#39;http://localhost:3000/bicingjson/&#39;</span>
      <span class="p">});</span>

      <span class="c1">//agregamos la capa con su estilo al mapa</span>
      <span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">({</span>
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing-source&quot;</span><span class="p">,</span>
        <span class="s2">&quot;paint&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;circle-radius&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;interpolate&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;to-number&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">,</span><span class="s1">&#39;capacity&#39;</span><span class="p">]],</span>
            <span class="mi">15</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">,</span>
            <span class="mi">50</span><span class="p">,</span>
            <span class="mi">33</span>
          <span class="p">],</span>
          <span class="s2">&quot;circle-color&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;interpolate&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;to-number&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;altitude&quot;</span><span class="p">]],</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;hsl(0, 88%, 55%)&quot;</span><span class="p">,</span>
            <span class="mi">50</span><span class="p">,</span>
            <span class="s2">&quot;hsl(108, 93%, 59%)&quot;</span>
          <span class="p">],</span>
          <span class="s2">&quot;circle-opacity&quot;</span><span class="o">:</span> <span class="mf">0.86</span>
        <span class="p">},</span>
      <span class="p">});</span>

      <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">map</span><span class="p">.</span><span class="nx">getSource</span><span class="p">(</span><span class="s1">&#39;bicing-source&#39;</span><span class="p">).</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000/bicingjson/&#39;</span><span class="p">);</span>
      <span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
    <span class="p">});</span>

<span class="hll">    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">      <span class="kd">var</span> <span class="nx">features</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">queryRenderedFeatures</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">point</span><span class="p">,</span> <span class="p">{</span> <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;bicing&#39;</span><span class="p">]</span> <span class="p">});</span>
</span><span class="hll">
</span><span class="hll">      <span class="c1">// if the features have no info, return nothing</span>
</span><span class="hll">      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">features</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">          <span class="k">return</span><span class="p">;</span>
</span><span class="hll">      <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">      <span class="kd">var</span> <span class="nx">feature</span> <span class="o">=</span> <span class="nx">features</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class="hll">
</span><span class="hll">      <span class="c1">// Populate the popup and set its coordinates</span>
</span><span class="hll">      <span class="c1">// based on the feature found</span>
</span><span class="hll">      <span class="kd">var</span> <span class="nx">popup</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Popup</span><span class="p">()</span>
</span><span class="hll">      <span class="p">.</span><span class="nx">setLngLat</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">coordinates</span><span class="p">)</span>
</span><span class="hll">      <span class="p">.</span><span class="nx">setHTML</span><span class="p">(</span><span class="s1">&#39;&lt;div id=\&#39;popup\&#39; class=\&#39;popup\&#39; style=\&#39;z-index: 10;\&#39;&gt; &lt;h5&gt; &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; &lt;/h5&gt;&#39;</span> <span class="o">+</span>
</span><span class="hll">      <span class="s1">&#39;&lt;ul class=\&#39;list-group\&#39;&gt;&#39;</span> <span class="o">+</span>
</span><span class="hll">      <span class="s1">&#39;&lt;li class=\&#39;list-group-item\&#39;&gt; &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">address</span> <span class="o">+</span> <span class="s1">&#39; &lt;/li&gt;&#39;</span> <span class="o">+</span>
</span><span class="hll">      <span class="s1">&#39;&lt;li class=\&#39;list-group-item\&#39;&gt; Altitud: &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">altitude</span> <span class="o">+</span> <span class="s1">&#39; &lt;/li&gt;&#39;</span> <span class="o">+</span>
</span><span class="hll">      <span class="s1">&#39;&lt;li class=\&#39;list-group-item\&#39;&gt; Capacidad: &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">capacity</span> <span class="o">+</span> <span class="s1">&#39; &lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&#39;</span><span class="p">)</span>
</span><span class="hll">      <span class="p">.</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
</span><span class="hll">    <span class="p">});</span>
</span>  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<ul>
<li>
<p>Recargar la página y hacer click sobre alguna estación para ver su información en tiempo real.</p>
</li>
<li>
<p>Cambiar el tipo de cursor al pasar sobre una estación. Escribir después de donde definimos el onload</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Servicio de Bicing realtime VectorTiles<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;viewport&#39;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#39;initial-scale=1,maximum-scale=1,user-scalable=no&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css&#39;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="nt">body</span> <span class="p">{</span>
      <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">#</span><span class="nn">map</span> <span class="p">{</span>
      <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
      <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
      <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
      <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;https://geoserveis.icgc.cat/contextmaps/icgc.json&#39;</span><span class="p">,</span>
      <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.1777</span><span class="p">,</span> <span class="mf">41.3887</span><span class="p">],</span>
      <span class="nx">zoom</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
      <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
      <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">//funcion que se llama al terminar de cargar el estilo del mapa</span>

      <span class="c1">//agregamos la fuente de datos al mapa</span>
      <span class="nx">map</span><span class="p">.</span><span class="nx">addSource</span><span class="p">(</span><span class="s1">&#39;bicing-source&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;geojson&#39;</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="s1">&#39;http://localhost:3000/bicingjson/&#39;</span>
      <span class="p">});</span>

      <span class="c1">//agregamos la capa con su estilo al mapa</span>
      <span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">({</span>
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing-source&quot;</span><span class="p">,</span>
        <span class="s2">&quot;paint&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;circle-radius&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;interpolate&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;to-number&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">,</span><span class="s1">&#39;capacity&#39;</span><span class="p">]],</span>
            <span class="mi">15</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">,</span>
            <span class="mi">50</span><span class="p">,</span>
            <span class="mi">33</span>
          <span class="p">],</span>
          <span class="s2">&quot;circle-color&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;interpolate&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;to-number&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;altitude&quot;</span><span class="p">]],</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;hsl(0, 88%, 55%)&quot;</span><span class="p">,</span>
            <span class="mi">50</span><span class="p">,</span>
            <span class="s2">&quot;hsl(108, 93%, 59%)&quot;</span>
          <span class="p">],</span>
          <span class="s2">&quot;circle-opacity&quot;</span><span class="o">:</span> <span class="mf">0.86</span>
        <span class="p">},</span>
      <span class="p">});</span>

      <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">map</span><span class="p">.</span><span class="nx">getSource</span><span class="p">(</span><span class="s1">&#39;bicing-source&#39;</span><span class="p">).</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000/bicingjson/&#39;</span><span class="p">);</span>
      <span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">features</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">queryRenderedFeatures</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">point</span><span class="p">,</span> <span class="p">{</span> <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;bicing&#39;</span><span class="p">]</span> <span class="p">});</span>

      <span class="c1">// if the features have no info, return nothing</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">features</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">feature</span> <span class="o">=</span> <span class="nx">features</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

      <span class="c1">// Populate the popup and set its coordinates</span>
      <span class="c1">// based on the feature found</span>
      <span class="kd">var</span> <span class="nx">popup</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Popup</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">setLngLat</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">coordinates</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">setHTML</span><span class="p">(</span><span class="s1">&#39;&lt;div id=\&#39;popup\&#39; class=\&#39;popup\&#39; style=\&#39;z-index: 10;\&#39;&gt; &lt;h5&gt; &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; &lt;/h5&gt;&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;&lt;ul class=\&#39;list-group\&#39;&gt;&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;&lt;li class=\&#39;list-group-item\&#39;&gt; &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">streetName</span> <span class="o">+</span> <span class="s1">&#39; &lt;/li&gt;&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;&lt;li class=\&#39;list-group-item\&#39;&gt; Bikes: &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">bikes</span> <span class="o">+</span> <span class="s1">&#39; &lt;/li&gt;&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;&lt;li class=\&#39;list-group-item\&#39;&gt; slots: &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">slots</span> <span class="o">+</span> <span class="s1">&#39; &lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
    <span class="p">});</span>

<span class="hll">    <span class="c1">// Use the same approach as above to indicate that the symbols are clickable</span>
</span><span class="hll">    <span class="c1">// by changing the cursor style to &#39;pointer&#39;</span>
</span><span class="hll">    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">        <span class="kd">var</span> <span class="nx">features</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">queryRenderedFeatures</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">point</span><span class="p">,</span> <span class="p">{</span> <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;bicing&#39;</span><span class="p">]</span> <span class="p">});</span>
</span><span class="hll">        <span class="nx">map</span><span class="p">.</span><span class="nx">getCanvas</span><span class="p">().</span><span class="nx">style</span><span class="p">.</span><span class="nx">cursor</span> <span class="o">=</span> <span class="nx">features</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="s1">&#39;pointer&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class="hll">    <span class="p">});</span>
</span>  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<ul>
<li>Recargar la página y pasar sobre alguna estación para ver el cambio del cursor.</li>
</ul>
<p><img alt="mapa de servicio de bicing" src="../img/mapa_bicing_vt.png" />
<em>mapa de servicio de bicing</em></p>
<h3 id="modificar-el-proxy">Modificar el proxy</h3>
<p>Modificaremos el proxy para agregar los datos de disponibilidad de bicis en las estaciones. Para ello debemos llamar al servicio de <a href="https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_status">estado de estaciones</a>.</p>
<p>Al abrir la url del servicio podemos ver que está el listado de las estaciones con una serie de datos. En este caso no hay datos de posición, ni de descripción sólo datos del estado de la estación. Podemos ver que también hay un campo con el <em>station_id</em> que nos servirá para vincular los datos de estado de la estación con la estación correspondiente.</p>
<ul>
<li>Agregar la url del servicio de estado de estaciones</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">var</span> <span class="nx">express</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span>      <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;axios&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">serverBicing</span> <span class="o">=</span> <span class="s1">&#39;https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information&#39;</span><span class="p">;</span>
<span class="hll"><span class="kd">var</span> <span class="nx">statusBicing</span> <span class="o">=</span> <span class="s1">&#39;https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_status&#39;</span><span class="p">;</span>
</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;/bicingjson/*&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;redirecting to Server2&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">geojson</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;FeatureCollection&#39;</span><span class="p">,</span>
    <span class="nx">features</span><span class="o">:</span> <span class="p">[]</span>
  <span class="p">};</span>
  <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">serverBicing</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
    <span class="c1">// handle success</span>
    <span class="kd">var</span> <span class="nx">stations</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">stations</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">stations</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">station</span> <span class="o">=</span> <span class="nx">stations</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">feature</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">,</span>
        <span class="nx">properties</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">altitude</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">altitude</span><span class="p">,</span>
          <span class="nx">id</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">station_id</span><span class="p">,</span>
          <span class="nx">address</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
          <span class="nx">post_code</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">post_code</span><span class="p">,</span>
          <span class="nx">capacity</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">capacity</span>
        <span class="p">},</span>
        <span class="nx">geometry</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span>
          <span class="nx">coordinates</span><span class="o">:</span> <span class="p">[</span><span class="nx">station</span><span class="p">.</span><span class="nx">lon</span><span class="p">,</span> <span class="nx">station</span><span class="p">.</span><span class="nx">lat</span><span class="p">]</span>
        <span class="p">}</span>
      <span class="p">};</span>
      <span class="nx">geojson</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">feature</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">geojson</span><span class="p">);</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</code></pre></div>

<ul>
<li>Combinar la información del estado de estaciones con la información de la estación</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">var</span> <span class="nx">express</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span>      <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;axios&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">serverBicing</span> <span class="o">=</span> <span class="s1">&#39;https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_information&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">statusBicing</span> <span class="o">=</span> <span class="s1">&#39;https://api.bsmsa.eu/ext/api/bsm/gbfs/v2/en/station_status&#39;</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;/bicingjson/*&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;redirecting to Server2&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">geojson</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;FeatureCollection&#39;</span><span class="p">,</span>
    <span class="nx">features</span><span class="o">:</span> <span class="p">[]</span>
  <span class="p">};</span>

<span class="hll">  <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">serverBicing</span><span class="p">),</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">statusBicing</span><span class="p">)]).</span><span class="nx">then</span><span class="p">((</span><span class="nx">responses</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">    <span class="kd">var</span> <span class="nx">stations</span> <span class="o">=</span> <span class="nx">responses</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">stations</span><span class="p">;</span>
</span><span class="hll">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">stations</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">      <span class="kd">var</span> <span class="nx">station</span> <span class="o">=</span> <span class="nx">stations</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class="hll">      <span class="kd">var</span> <span class="nx">feature</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">properties</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">          <span class="nx">altitude</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">altitude</span><span class="p">,</span>
</span><span class="hll">          <span class="nx">id</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">station_id</span><span class="p">,</span>
</span><span class="hll">          <span class="nx">address</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
</span><span class="hll">          <span class="nx">post_code</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">post_code</span><span class="p">,</span>
</span><span class="hll">          <span class="nx">capacity</span><span class="o">:</span> <span class="nx">station</span><span class="p">.</span><span class="nx">capacity</span>
</span><span class="hll">        <span class="p">},</span>
</span><span class="hll">        <span class="nx">geometry</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span>
</span><span class="hll">          <span class="nx">coordinates</span><span class="o">:</span> <span class="p">[</span><span class="nx">station</span><span class="p">.</span><span class="nx">lon</span><span class="p">,</span> <span class="nx">station</span><span class="p">.</span><span class="nx">lat</span><span class="p">]</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">      <span class="p">};</span>
</span><span class="hll">      <span class="nx">geojson</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">feature</span><span class="p">);</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">    <span class="kd">var</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">responses</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">stations</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">status</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">        <span class="kd">var</span> <span class="nx">stat</span> <span class="o">=</span> <span class="nx">status</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class="hll">        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">geojson</span><span class="p">.</span><span class="nx">features</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="kd">var</span> <span class="nx">feat</span> <span class="o">=</span> <span class="nx">geojson</span><span class="p">.</span><span class="nx">features</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
</span><span class="hll">            <span class="k">if</span><span class="p">(</span><span class="nx">feat</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">station_id</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">                <span class="nx">feat</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">num_bikes_available</span> <span class="o">=</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">num_bikes_available</span><span class="p">;</span>
</span><span class="hll">                <span class="nx">feat</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">num_bikes_available_types</span> <span class="o">=</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">num_bikes_available_types</span><span class="p">;</span>
</span><span class="hll">                <span class="nx">feat</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">num_docks_available</span> <span class="o">=</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">num_docks_available</span><span class="p">;</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="hll">    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">geojson</span><span class="p">);</span>
</span><span class="hll">  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span class="hll">    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span class="hll">  <span class="p">});</span>
</span><span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</code></pre></div>

<h3 id="modificar-el-visor_1">Modificar el visor</h3>
<ul>
<li>Modificaremos el visor para cambiar el color del círculo dependiendo del númere de bicis disponibles en la estación</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Servicio de Bicing realtime VectorTiles<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;viewport&#39;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#39;initial-scale=1,maximum-scale=1,user-scalable=no&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css&#39;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="nt">body</span> <span class="p">{</span>
      <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">#</span><span class="nn">map</span> <span class="p">{</span>
      <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
      <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
      <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
      <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;https://geoserveis.icgc.cat/contextmaps/icgc.json&#39;</span><span class="p">,</span>
      <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.1777</span><span class="p">,</span> <span class="mf">41.3887</span><span class="p">],</span>
      <span class="nx">zoom</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
      <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
      <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">//funcion que se llama al terminar de cargar el estilo del mapa</span>

      <span class="c1">//agregamos la fuente de datos al mapa</span>
      <span class="nx">map</span><span class="p">.</span><span class="nx">addSource</span><span class="p">(</span><span class="s1">&#39;bicing-source&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;geojson&#39;</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="s1">&#39;http://localhost:3000/bicingjson/&#39;</span>
      <span class="p">});</span>

      <span class="c1">//agregamos la capa con su estilo al mapa</span>
      <span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">({</span>
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;bicing-source&quot;</span><span class="p">,</span>
        <span class="s2">&quot;paint&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;circle-radius&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;interpolate&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;to-number&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">,</span><span class="s1">&#39;capacity&#39;</span><span class="p">]],</span>
            <span class="mi">15</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">,</span>
            <span class="mi">50</span><span class="p">,</span>
            <span class="mi">33</span>
          <span class="p">],</span>
<span class="hll">          <span class="s2">&quot;circle-color&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class="hll">            <span class="s2">&quot;interpolate&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">],</span>
</span><span class="hll">            <span class="p">[</span><span class="s2">&quot;to-number&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;num_bikes_available&quot;</span><span class="p">]],</span>
</span><span class="hll">            <span class="mi">0</span><span class="p">,</span>
</span><span class="hll">            <span class="s2">&quot;#ff0000&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="mi">15</span><span class="p">,</span>
</span><span class="hll">            <span class="s2">&quot;#00ff00&quot;</span>
</span><span class="hll">          <span class="p">],</span>
</span>          <span class="s2">&quot;circle-opacity&quot;</span><span class="o">:</span> <span class="mf">0.86</span>
        <span class="p">},</span>
      <span class="p">});</span>

      <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">map</span><span class="p">.</span><span class="nx">getSource</span><span class="p">(</span><span class="s1">&#39;bicing-source&#39;</span><span class="p">).</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000/bicingjson/&#39;</span><span class="p">);</span>
      <span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">features</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">queryRenderedFeatures</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">point</span><span class="p">,</span> <span class="p">{</span> <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;bicing&#39;</span><span class="p">]</span> <span class="p">});</span>

      <span class="c1">// if the features have no info, return nothing</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">features</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">feature</span> <span class="o">=</span> <span class="nx">features</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

      <span class="c1">// Populate the popup and set its coordinates</span>
      <span class="c1">// based on the feature found</span>
      <span class="kd">var</span> <span class="nx">popup</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Popup</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">setLngLat</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">coordinates</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">setHTML</span><span class="p">(</span><span class="s1">&#39;&lt;div id=\&#39;popup\&#39; class=\&#39;popup\&#39; style=\&#39;z-index: 10;\&#39;&gt; &lt;h5&gt; &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; &lt;/h5&gt;&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;&lt;ul class=\&#39;list-group\&#39;&gt;&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;&lt;li class=\&#39;list-group-item\&#39;&gt; &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">streetName</span> <span class="o">+</span> <span class="s1">&#39; &lt;/li&gt;&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;&lt;li class=\&#39;list-group-item\&#39;&gt; Bikes: &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">bikes</span> <span class="o">+</span> <span class="s1">&#39; &lt;/li&gt;&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;&lt;li class=\&#39;list-group-item\&#39;&gt; slots: &#39;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">slots</span> <span class="o">+</span> <span class="s1">&#39; &lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c1">// Use the same approach as above to indicate that the symbols are clickable</span>
    <span class="c1">// by changing the cursor style to &#39;pointer&#39;</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">features</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">queryRenderedFeatures</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">point</span><span class="p">,</span> <span class="p">{</span> <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;bicing&#39;</span><span class="p">]</span> <span class="p">});</span>
        <span class="nx">map</span><span class="p">.</span><span class="nx">getCanvas</span><span class="p">().</span><span class="nx">style</span><span class="p">.</span><span class="nx">cursor</span> <span class="o">=</span> <span class="nx">features</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="s1">&#39;pointer&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<div class="admonition question">
<p class="admonition-title">Ejercicio</p>
<p>Cambiar el estilo de los puntos de las estaciones. Cambiar los rangos del tamaño del punto y cambiar el rango de colores.</p>
</div>
<h2 id="referencias">Referencias</h2>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p><a href="https://es.wikipedia.org/wiki/GeoJSON">https://es.wikipedia.org/wiki/GeoJSON</a>&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p><a href="https://www.mapbox.com/mapbox-gl-js/api/">https://www.mapbox.com/mapbox-gl-js/api/</a>&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p><a href="https://nodejs.org/es/">https://nodejs.org/es/</a>&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p><a href="https://es.wikipedia.org/wiki/Servidor_proxy">https://es.wikipedia.org/wiki/Servidor_proxy</a>&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:5">
<p><a href="http://expressjs.com/">http://expressjs.com/</a>&#160;<a class="footnote-backref" href="#fnref:5" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:6">
<p><a href="https://github.com/axios/axios">https://github.com/axios/axios</a>&#160;<a class="footnote-backref" href="#fnref:6" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
<li id="fn:7">
<p><a href="https://www.mapbox.com/mapbox-gl-js/style-spec">https://www.mapbox.com/mapbox-gl-js/style-spec</a>&#160;<a class="footnote-backref" href="#fnref:7" title="Jump back to footnote 7 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Pie">
        
          <a href="../9_ejemplo_servicio_bicing_bcn/" title="9. Ejemplo servicio bicing Barcelona" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                9. Ejemplo servicio bicing Barcelona
              </div>
            </div>
          </a>
        
        
          <a href="../11_consideraciones_servicios_realtime_sensores/" title="11. Consideraciones sobre servicios de Sensores" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                11. Consideraciones sobre servicios de Sensores
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copiar al portapapeles", "clipboard.copied": "Copiado al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>